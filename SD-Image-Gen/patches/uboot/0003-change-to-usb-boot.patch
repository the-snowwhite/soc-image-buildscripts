From 1466f238eb2bd59b813e99b02f944f90a89802ba Mon Sep 17 00:00:00 2001
From: the-snowwhite <producer@holotronic.dk>
Date: Sun, 20 Mar 2016 20:29:19 +0100
Subject: [PATCH 3/3] change to usb boot

---
 include/configs/socfpga_de0_nano_soc.h | 21 +++++++++++----------
 1 file changed, 11 insertions(+), 10 deletions(-)

diff --git a/include/configs/socfpga_de0_nano_soc.h b/include/configs/socfpga_de0_nano_soc.h
index abe5202..6a95f66 100644
--- a/include/configs/socfpga_de0_nano_soc.h
+++ b/include/configs/socfpga_de0_nano_soc.h
@@ -37,7 +37,7 @@
 #define CONFIG_BOOTDELAY	3
 #define CONFIG_BOOTFILE		"fitImage"
 #define CONFIG_BOOTARGS		"console=ttyS0," __stringify(CONFIG_BAUDRATE)
-#define CONFIG_BOOTCOMMAND	"run fpgaconfig; run mmcload; run mmcboot"
+#define CONFIG_BOOTCOMMAND	"usb start; run fpgaconfig; run usbload; run usbboot"
 #define CONFIG_LOADADDR		0x01000000
 #define CONFIG_SYS_LOAD_ADDR	CONFIG_LOADADDR
 
@@ -47,7 +47,8 @@
 #define CONFIG_PHY_MICREL_KSZ9031
 #endif
 
-#define CONFIG_ENV_IS_IN_MMC
+//#define CONFIG_ENV_IS_IN_MMC
+#define CONFIG_ENV_IS_IN_SPI_FLASH
 
 /* Extra Environment */
 #define CONFIG_EXTRA_ENV_SETTINGS \
@@ -59,17 +60,17 @@
 	"fdtimage=socfpga.dtb\0" \
 	"fpgaimage=socfpga.rbf\0" \
 	"fpgadata=0x2000000\0" \
-	"fpgaconfig=load mmc 0:2 ${fpgadata} ${fpgaimage};" \
+	"fpgaconfig=load usb 0:2 ${fpgadata} ${fpgaimage};" \
 	"fpga load 0 ${fpgadata} ${filesize}\0" \
 	"bootm ${loadaddr} - ${fdt_addr}\0" \
-	"mmcroot=/dev/mmcblk0p3\0" \
-	"mmcboot=setenv bootargs " CONFIG_BOOTARGS \
-		" root=${mmcroot} rw rootwait;" \
+	"usbroot=/dev/sda3\0" \
+	"usbboot=setenv bootargs " CONFIG_BOOTARGS \
+		" root=${usbroot} rw rootwait;" \
 		"bootz ${loadaddr} - ${fdt_addr}\0" \
-	"mmcload=mmc rescan;" \
-		"load mmc 0:2 ${fpgadata} ${fpgaimage};" \
-		"load mmc 0:2 ${loadaddr} ${bootimage};" \
-		"load mmc 0:2 ${fdt_addr} ${fdtimage}\0" \
+	"usbload=usb reset;" \
+		"load usb 0:2 ${fpgadata} ${fpgaimage};" \
+		"load usb 0:2 ${loadaddr} ${bootimage};" \
+		"load usb 0:2 ${fdt_addr} ${fdtimage}\0" \
 
 /* The rest of the configuration is shared */
 #include <configs/socfpga_common.h>
-- 
2.7.0

